var synkitApp=angular.module("synkApp",["ngRoute","ngAnimate","firebase","pagination"]);synkitApp.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"views/home.html",controller:"HomeController",resolve:{currentAuth:["Auth",function(e){return e.$waitForSignIn()}]}}).when("/auth/signup",{templateUrl:"views/auth/signup.html",controller:"AuthController"}).when("/auth/signin",{templateUrl:"views/auth/signin.html",controller:"AuthController"}).when("/user/category/:id?",{templateUrl:function(e){return e.id?"views/category-bookmarks.html":"views/category.html"},controller:"CategoryController",resolve:{currentAuth:["Auth",function(e){return e.$waitForSignIn()}]}}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location",function(e,t){e.$on("$locationChangeStart",function(e,o,r){firebase.auth().onAuthStateChanged(function(e){e||t.path("/auth/signin")})})}]).service("appService",["$firebaseAuth",function(e){this.getCurrentUser=function(){return e().$getAuth()}}]).factory("Auth",["$firebaseAuth",function(e){return e()}]).controller("HomeController",["$scope","$firebaseArray","$rootScope","appService","currentAuth",function(e,t,o,r,a){e.pageTitle="Home page",e.addModalRequest=!1,e.editModalRequest=!1,e.url="",e.titleError="",e.urlError="",e.orderProperty="title",e.sortByTitle=!0,e.sortByCategory=!1,e.sortByDate=!1,e.loading=!0;var n=r.getCurrentUser();const i=firebase.database().ref().child(n.uid),l=i.child("categories"),c=i.child("bookmarks");var d=t(c);e.categories=t(l),e.categories.$loaded().then(function(){angular.forEach(d,function(t,o){var r=t.category;t.categoryName=null==r?"Uncategorised":e.categories.$getRecord(r).name}),e.bookmarks=d,e.loading=!1}),e.showAddBookmarkModal=function(){e.addModalRequest=!0},e.addBookmark=function(t){e.formData=angular.copy(t);var o=e.formData.title,r=e.formData.url,a=e.formData.urlCategory||null;if(!o||!r)return o||(e.titleError="Please enter a valid title"),void(r||(e.urlError="Please enter a valid Url"));var n=new Date,i=n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear(),l={title:o,url:r,category:a,modified:i};e.bookmarks.$add(l),e.addModalRequest=!1,t.title="",t.urlCategory="",t.url=""},e.deleteBookamrk=function(t){e.bookmarks.$remove(t)},e.editBookmarkRequest=function(t){e.form={},e.editModalRequest=!0,e.form.title=t.title,e.form.url=t.url,e.form.id=t.$id,e.form.urlCategories=e.categories,e.form.urlCategory=e.categories.$getRecord(t.category).$id},e.editBookmark=function(t){e.formData=angular.copy(t);var o=e.formData.title,r=e.formData.url;if(!o||!r)return o||(e.titleError="Please enter a valid title"),void(r||(e.urlError="Please enter a valid Url"));var a=new Date,n=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),i=e.formData.id,l=e.bookmarks.$getRecord(i);l.title=o,l.url=r,l.modified=n,l.category=e.formData.urlCategory,l.categoryName=e.categories.$getRecord(e.formData.urlCategory).name,e.bookmarks.$save(l),e.titleError="",e.urlError="",e.editModalRequest=!1,t.title="",t.urlCategory="",t.url=""},e.cancelModal=function(t){e.addModalRequest=!1,e.editModalRequest=!1,e.titleError="",e.urlError="",t.title="",t.urlCategory="",t.url=""},e.setOrderProperty=function(t){e.orderProperty===t?e.orderProperty="-"+t:(e.orderProperty,e.orderProperty=t),"title"===t?(e.sortByTitle=!0,e.sortByCategory=!1,e.sortByDate=!1):"categoryName"===t?(e.sortByTitle=!1,e.sortByCategory=!0,e.sortByDate=!1):(e.sortByTitle=!1,e.sortByCategory=!1,e.sortByDate=!0)},e.showQrModal=function(e){var t="",o=new tingle.modal({footer:!0,stickyFooter:!0,closeMethods:[],closeLabel:"Close",onOpen:function(){console.log("modal open")},onClose:function(){console.log("modal closed")},beforeClose:function(){return!0}});t+='<div id="qrcode"></div>',t+='<div class="input-group">',t+="<p>"+e.url+"</p>",t+='<button aria-label="Copied" ng-click="copyToClipboard()" data-clipboard-text="'+e.url+'" class="copyToClipboard" type="button">',t+="Copy to clipboard",t+="</button></div>",o.setContent(t),o.addFooterBtn("Close","tingle-btn tingle-btn--default tingle-btn--pull-right",function(){o.close()}),new QRCode("qrcode",{text:e.url,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}).makeCode(e.url),o.open()}}]).controller("AuthController",["$scope","$location","$rootScope","appService",function(e,t,o,r){e.error="",e.user=null,e.windowWidth=document.documentElement.clientWidth,window.onresize=function(){e.$apply(function(){e.windowWidth=document.documentElement.clientWidth})},e.signInWithGoogle=function(){var r=new firebase.auth.GoogleAuthProvider;r.addScope("https://www.googleapis.com/auth/plus.login"),firebase.auth().signInWithPopup(r).then(function(r){var a=(r.credential.accessToken,r.user);e.user=a,o.$apply(function(){t.path("/")})}).catch(function(t){var r=(t.code,t.message,t.email);t.credential;e.error='"'+r+'" is already registered with different authentication method',o.$apply()})},e.signInWithFacebook=function(){var t=new firebase.auth.FacebookAuthProvider;firebase.auth().signInWithPopup(t).then(function(t){var o=(t.credential.accessToken,t.user);e.user=o}).catch(function(t){var r=(t.code,t.message,t.email);t.credential;e.error='"'+r+'" is already registered with different authentication method',o.$apply()})},e.signOut=function(){firebase.auth().signOut().then(function(){o.$apply(function(){t.path("/auth/signin")})}).catch(function(e){})},e.user=r.getCurrentUser()||"https://randomuser.me/api/portraits/men/51.jpg"}]).controller("CategoryController",["$scope","$rootScope","$firebaseAuth","$firebaseArray","appService","currentAuth","$routeParams",function(e,t,o,r,a,n,i){var l=i.id;e.addCategoryModalRequest=!1,e.editCategoryModalRequest=!1,e.categoryError="",e.loading=!0,e.sortByName=!0,e.sortByDate=!1,e.orderProperty="name";var c=a.getCurrentUser();const d=firebase.database().ref().child(c.uid);if(l){const u=d.child("categories");var s=r(u);s.$loaded().then(function(t){var o=t.$getRecord(l);e.pageTitle='Bookmarks under "'+o.name+'"'});const g=d.child("bookmarks");var f=r(g);e.bookmarks=[],f.$loaded().then(function(t){angular.forEach(t,function(t,o){t.category==l&&e.bookmarks.push(t)}),e.loading=!1})}else{e.pageTitle="Category Page";const g=d.child("categories");var s=r(g);e.categories=s,e.categories.$loaded().then(function(){e.loading=!1})}e.showAddCategoryModal=function(){e.addCategoryModalRequest=!0},e.editCategoryShow=function(t){e.formData={},e.editCategoryModalRequest=!0,e.formData.id=t.$id,e.formData.name=t.name},e.deleteCategory=function(t){e.categories.$remove(t)},e.cancelModal=function(t){e.addCategoryModalRequest=!1,e.editCategoryModalRequest=!1,t.name="",e.categoryError=""},e.addCategory=function(t){var o=new Date,r=o.getDate()+"/"+(o.getMonth()+1)+"/"+o.getFullYear();if(!t)return void(e.categoryError="Please enter a valid name");var a=angular.copy(t),n=a.name;e.addCategoryModalRequest=!1,a.name="",e.categoryError="",category.$add({name:n,modified:r}).then(function(e){var o=e.key;t.name="",console.log("added with id",o)})},e.editCategory=function(){var t=new Date,o=e.formData.name;if(o){var r=t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear(),a=e.formData.id,n=e.categories.$getRecord(a);n.name=o,n.modified=r,e.categories.$save(n),e.formData.name="",e.editCategoryModalRequest=!1}},e.setOrderProperty=function(t){e.orderProperty===t?e.orderProperty="-"+t:(e.orderProperty,e.orderProperty=t),"name"===t?(e.sortByName=!0,e.sortByDate=!1):"modified"===t&&(e.sortByName=!1,e.sortByDate=!0)}}]).controller("MainController",["$scope","$rootScope","Auth","appService","$location",function(e,t,o,r,a){e.windowWidth=document.documentElement.clientWidth,e.loading=!0,window.onresize=function(){e.$apply(function(){e.windowWidth=document.documentElement.clientWidth})},o.$waitForSignIn().then(function(t){e.user=t,e.user.firstName=t.displayName.split(" ")[0],e.loading=!1}),e.signOut=function(){firebase.auth().signOut().then(function(){t.$apply(function(){a.path("/auth/signin")})}).catch(function(e){})},e.getPath=function(e){return a.path()==e?"active":""},e.navigate=function(t){e.windowWidth<640&&(document.getElementById("nav-state").checked=!0),a.path(t)}}]);